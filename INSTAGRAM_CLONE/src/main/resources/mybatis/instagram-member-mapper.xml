<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="member">
	
	<select id="login" parameterType="MemberVo" resultType="MemberVo">
		select * 
		from MEMBER
		where MEMBER_EMAIL = #{member_email} AND MEMBER_PW = #{member_pw}
	</select>
	
	<select id="snsLogin" parameterType="MemberVo" resultType="MemberVo">
		select * 
		from MEMBER
		where SNS_TYPE = #{sns_type} AND SNS_ID = #{sns_id} AND MEMBER_EMAIL = #{member_email}
	</select>
	
	<select id="selectMemberProfile" parameterType="int" resultType="MemberProfileVo">
		select * 
		from MEMBER_PROFILE
		where MEMBER_CODE = #{member_code}
	</select>
	
	<select id="emailCheck" parameterType="MemberVo" resultType="int">
		select count(*)
		from MEMBER
		where MEMBER_EMAIL = #{member_email}
	</select>
	
	<select id="idCheck" parameterType="MemberVo" resultType="int">
		select count(*) 
		from MEMBER
		where MEMBER_ID = #{member_id}
	</select>
	
	<insert id="join" parameterType="MemberVo">
		insert into MEMBER 
		VALUES(nextval('MEMBER_CODE_SEQ'),#{member_email},#{member_phone},
				#{member_name},#{member_id},#{member_pw},'','')
	</insert>
	
	<insert id="insertProfile" parameterType="MemberProfileVo">
		insert into MEMBER_PROFILE (MEMBER_CODE) 
		VALUES(#{member_code})
	</insert>
	
	<update id="updateMemberProfileImage" parameterType="MemberProfileVo">
		UPDATE MEMBER_PROFILE
		SET MEMBER_PROFILE_IMAGE_NAME = #{member_profile_image_name}
			, MEMBER_PROFILE_IMAGE_S_NAME = #{member_profile_image_s_name}
			, MEMBER_PROFILE_PATH = #{member_profile_image_path}
		WHERE MEMBER_CODE = #{member_code}
	</update>
	
	<select id="nameSearchAutoComplete" parameterType="map" resultType="MemberJoinProfileVo">
		select * 
		from MEMBER m, MEMBER_PROFILE mp
		where m.member_code = mp.member_code
		and m.member_id like '%${id_name}%' 
		and m.member_name like '%${id_name}%'
		and m.member_code != #{my_member_code}
	</select>
	
	<select id="selectMemberList" parameterType="map" resultType="MemberJoinProfileSimpleVo">
		select *
		from MEMBER m, MEMBER_PROFILE mp
		where m.member_code = mp.member_code
		
		<choose>
            <when test="codeList.size != 0">
                and m.member_code 
                <foreach collection="codeList" item="item" index="index" separator="," open="in (" close=")">
                    #{item}
                </foreach>
            </when>
        </choose>
	</select>
</mapper>
